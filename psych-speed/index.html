<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>The Psychology of Speed - @SimonHearne</title>

		<meta name="description" content="Presentation: the psychology of speed. Presented at Akamai DPM Event, Stockholm, April 2019">
		<meta name="author" content="Simon Hearne">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../css/reveal.css">
		<link rel="stylesheet" href="../css/theme/simon.css" id="theme">

		<link rel="preload" as="font" type="font/woff2" crossorigin href="../lib/font/league-gothic/league-gothic.woff2">
		<link rel="preload" as="font" type="font/woff" crossorigin href="../lib/font/league-gothic/league-gothic.woff">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../css/print/pdf.css' : '../css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="reveal">
			<div class="smaller tagline">@SimonHearne</div>
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-state="title-slide">
					<h1>The Psychology of <span style="display:block; font-style:oblique;">Speed</span></h1>
					<p style="text-align: center;">Simon Hearne</p>
					<p class="smaller" style="text-align: center;">Web Performance Solutions Engineer @ Akamai</p>

					<aside class="notes">
						We intuitively know that slow websites cause frustration, but intuition doesn‚Äôt pay for developers! In this talk I want to explore the latest research and analysis on the psychology of web performance. I‚Äôll also dig into some of the trillions of user experience beacons we‚Äôve collected through mPulse to try to identify the best timers to represent user experience, and how they impact key performance indicators like time on page and session length.
					</aside>
				</section>

				<section>
					<h3>We've all seen the studies...</h3>
					<table class="twocol">
						<tr>
							<td><img class="plain" data-src="media/walmart.png"/></td>
							<td>Walmart sees 1% increase in revenue for every 100ms improvement</td>
						</tr>
						<tr class="fragment">
							<td><img class="plain" data-src="media/staples.png"/></td>
							<td>Staples saw a 10% increase in conversion rate when reducing homepage load time by one second</td>
						</tr>
						<tr class="fragment">
							<td><img class="plain" data-src="media/aliexpress.png"/></td>
							<td>AliExpress saw 10.5% increase in conversions when reducing load time by 36%</td>
						</tr>
					</table>
					<p class="subtitle smallest bottom-right"><a href="https://wpostats.com/tags/conversion/">wpostats.com/tags/conversion/</a></p>
					<aside class="notes">
						There are plenty of studies to show how reducing load time improves business metrics. By they tend to focus on US retailers and rarely share the specific timers or test conditions.
					</aside>
				</section>

				<section>
					<h3>We've all seen the studies...</h3>
					<table class="twocol">
						<tr>
							<td><img class="plain" data-src="media/bbc.png"/></td>
							<td>The BBC loses an additional 10% of users for every additional second it takes to load</td>
						</tr>
						<tr class="fragment">
							<td><img class="plain" data-src="media/pinterest.png"/></td>
							<td>Pinterest improved load time by 40% and saw 15% increase in SEO traffic and 15% increase in conversions</td>
						</tr>
						<tr class="fragment">
							<td><img class="plain" data-src="media/ft.png"/></td>
							<td>The Financial times increased user engagement by 30% when they released the new, performance focused FT.com</td>
						</tr>
					</table>
					<p class="subtitle smallest bottom-right"><a href="https://wpostats.com/tags/engagement/">wpostats.com/tags/engagement/</a></p>
					<aside class="notes">
						There are also studies which show how engagement increases when speed is improved, but what is engagement, and what is speed? Unfortunately it is extremely rare for these case studies to include the things we really care about - what metric did they use to measure speed? How did they collect it, or aggregate it? The BBC loses an additional 10% of users for every second their site gets slower - what is a lost user? A bounce or a session that never happens? These are all important questions and caveats to bear in mind when viewing case studies, they are useful tools to generate interest in speed but the critical task is to perform this analysis on _your own data_.
					</aside>
				</section>
				<section>
					<blockquote>Banks understand that they need to create high-performance and reliable apps to conserve their market share and meet client expectations.</blockquote>
					<p class="smallest bottom-right"><a href="https://www.finextra.com/blogposting/15282/top-5-critical-issues-for-testing-mobile-banking-apps">Top 5 Critical Issues for Testing Mobile Banking Apps - Finextra 2018</a></p>
				</section>

				<section>
					<section>
						<h3>What do we mean by speed?</h3>
					</section>

					<section>
						<h3>There are plenty of technical measures</h3>
						<img class="stretch" data-src="media/navtiming.png"/>
						<p class="subtitle smallest bottom-right"><a href="https://w3c.github.io/perf-timing-primer/">w3c.github.io/perf-timing-primer/</a></p>
					</section>

					<section>
						<h3>What <em>actually</em> matters? ü§î</h3>
						<ol>
							<li class="fragment">Is it working?</li>
							<li class="fragment">Is it useful?</li>
							<li class="fragment">Is it interactive?</li>
						</ol>
					</section>

					<section>
						<h3>Is it working?</h3>
						<video class="stretch" muted autoplay data-autoplay data-src="media/akamai-1.mov"></video>
					</section>

					<section>
						<h3>Is it working?</h3>
						<ul>
							<li>Time to First Byte</li>
							<li>First Paint</li>
						</ul>
					</section>

					<section>
						<h3>Is it useful?</h3>
						<video class="stretch" muted autoplay data-autoplay data-src="media/akamai-2.mov"></video>
					</section>

					<section>
						<h3>Is it useful?</h3>
						<ul>
							<li>DOM Content Loaded</li>
							<li>First Contentful Paint</li>
							<li>Time to Visually Ready<sup>*</sup></li>
						</ul>
						<p class="smallest bottom-right"><sup>*</sup>mPulse only</p>
					
					</section>

					<section>
						<h3>Is it interactive?</h3>
						<video class="stretch" muted autoplay loop data-autoplay data-src="media/tti.mp4"></video>
					</section>

					<section>
						<h3>Is it interactive?</h3>
						<ul>
							<li>Time to Interactive</li>
							<li>First Input Delay</li>
							<li>Rage Clicks<sup>*</sup></li>
						</ul>
						<p class="smallest bottom-right"><sup>*</sup>mPulse only</p>
					</section>
					<!--
					<section id="poll-1" data-state="secondary-slide">
						<h2>POLL 1</h2>
						<p>What do you measure?</p>
						<ul>
							<li>Page Load Time</li>
							<li>DOM Timings</li>
							<li>Paint Timings</li>
							<li>Time to Interactive</li>
							<li>Custom Timers?</li>
						</ul>
					</section>
					-->
					<section>
						<h3>User Timing API ü¶Ñ</h3>
						<!--
						<img data-data-src="http://dev.local:3000/user-timing"/>-->
						<pre><code>
window.addEventListener(
  'scroll',
  ()=>{
    performance.mark('first-scroll');
  },
  {once: true, capture: false, passive: true}
);
						</code></pre>
						<p class="smallest bottom-right"><sup>*</sup>probably don't use this in production</p>
						<img class="plain" data-src="https://caniuse-icon.herokuapp.com/user-timing"/>
					</section>

					<section>
						<h3>Timer Summary</h3>
						<table class="list">
							<tr><td>Time to First Byte (TTFB)</td><td>The speed of the delivery stack</td></tr>
							<tr><td>DOM Content Loaded (DCL)</td><td>The speed of critical dependencies</td></tr>
							<tr><td>DOM Ready</td><td>How fast the page is parsed</td></tr>
							<tr><td>First Paint (FP)</td><td>The first time <em>something</em> is rendered</td></tr>
							<tr><td>First Contentful Paint (FCP)</td><td>When the user <em>might</em> first see content</td></tr>
							<tr><td>Time To Visually Ready (TTVR)</td><td>When key content is rendered</td></tr>
							<tr><td>Page Load Time (PLT)</td><td>When the page is complete</td></tr>
							<tr><td>Time To Interactive (TTI)</td><td>When the app is first responsive to input</td></tr>
							<tr><td>Time to First Interaction (TTFI)</td><td>When a user first tries to interact</td></tr>
							<tr><td>First Input Delay (FID)</td><td>How long it takes to respond to input</td></tr>
						</table>
						<p class="fragment smallest bottom-right"><a href="https://developer.akamai.com/mpulse/whats-in-a-beacon/">developer.akamai.com/mpulse/whats-in-a-beacon/</a></p>
					</section>
				</section>

				<section id="intermission-1" data-state="main-slide">
					<section class="center">
						<h2 class="intermission">&lt; psychology &gt;</h2>
					</section>
					<section>
						<h2>Objective vs Subjective time</h2>
						<p>Users don't measure your speed with a stopwatch</p>
					</section>
					<section>
						<h3>How long does a minute feel?</h3>
						<img class="stretch" data-src="media/table.jpg"/>
					</section>
					<section>
						<h3>How long does a minute feel?</h3>
						<img class="stretch" data-src="media/waitingroom.jpg"/>
					</section>
					<section>
						<h3>Does a minute feel longer to some people?</h3>
						<img height="400" data-src="media/younger.png"/>
						<img height="400" data-src="media/teenager.png"/>
						<img height="400" data-src="media/professional.png"/>
						<img height="400" data-src="media/elder.png"/>
					</section>
					<section>
						<blockquote>A new experience-centered generation, with higher expectations and lower loyalty appears, pressuring banks to review their online services.</blockquote>
						<p class="smallest bottom-right">Deloitte Luxembourg Digital Banking Benchmark, 2019</p>
					</section>
					<section>
						<h3>Our <span data-delay="0.5" data-animate="jackInTheBox">perception</span> of time is <span data-delay="1.5" data-animate="rubberBand">subjective...</span></h3>
						<h3 data-delay="2.5" data-animate="flipInX">...but our measures are objective</h3>
					</section>
					<section>
						<h3>What about web performance?</h3>
						<p class="fragment" data-fragment-index="1">Perception is <em>15%-35% slower</em> than objective measures<br><span class="smaller">(more <em>waiting room</em> than <em>romantic evening</em>)</span></p>
						<p class="fragment" data-fragment-index="2">Find the metric closest to user perception<sup>*</sup></p>
						<p class="fragment smallest bottom-right" data-fragment-index="2"><sup>*</sup>this depends entirely on your app!</p>
					</section>
					<section>
						<h3>The impact of 500ms</h3>
						<img class="plain stretch" data-src="media/tesco500ms.png">
						<p class="subtitle smallest bottom-right"><a href="https://www.slideshare.net/Radware/radware-irmc-mobilewebstresstammyeverts">How Poor Mobile Performance Hurts Your Brand</a></p>
					</section>
					<section>
						<h3>We cannot control expectation</h3>
						<code>satisfaction = perception - expectation</code>
						<p class="subtitle smallest bottom-right"><a href="https://davidmaister.com/articles/the-psychology-of-waiting-lines/">The Psychology of Waiting Lines by David Maister</a></p>
					</section>
					<section>
						<h3>But we can optimise perception...</h3>
						<p class="bottom-right smallest"><a href="https://signalvnoise.com/posts/1244-defining-the-problem-of-elevator-waiting-times">Defining the Problem of Elevetaor Waiting Times</a></p>
					</section>
					<section>
						<h3>Slow elevators...</h3>
						<img class="plain stretch" data-src="media/elevator1.jpg"/>
						<p class="bottom-right smallest"><a href="https://signalvnoise.com/posts/1244-defining-the-problem-of-elevator-waiting-times">Defining the Problem of Elevetaor Waiting Times</a></p>
					</section>
					<section>
						<h3>Waiting for baggage...</h3>
						<img class="plain stretch" data-src="media/baggage1.jpg"/>
					</section>
					<section>
						<h3>Crossing the street...</h3>
						<img class="plain stretch" data-src="media/crosswalk1.jpg"/>
					</section>
					<section>
						<h3>We can do this on the web!</h3>
					</section>
					<section>
						<h3>Progressive loading</h3>
						<img class="plain stretch" style="height: 9rem;" data-src="media/facebook.gif"/>
					</section>
					<section>
						<h3>Skeleton UI</h3>
						<video class="stretch" style="height: 9rem;" muted autoplay loop data-src="media/slack.mov"/>
					</section>
					<section>
						<h3>Optimistic UI</h3>
						<video class="stretch" autoplay muted loop data-src="media/allbirds-mobile.mov"/>
					</section>
					<section>
						<h3>Progress Indicators</h3>
						<video class="stretch"" autoplay muted loop data-src="media/all-birds-mobile1.mov"/>
					</section>
				</section>

				<section>
					<section id="speed-1">
						<h2>Speed? <span data-animate="zoomOutRight" data-delay="1">üöÄ</span></h2>
					</section>
					<section>
						<blockquote>we found a good correlation between a faster login time and a better user rating. Challengers are in the lower quartile with logins under 6 seconds! In contrast, the average login for incumbents was a sluggish 12 seconds</blockquote>
						<p class="smallest bottom-right"><a href="https://www.visa.co.uk/visa-everywhere/blog/bdp/2019/04/15/when-it-comes-1555317494581.html">When it comes to mobile banking apps, what makes a winner? - Visa 2018</a></p>
					</section>
					<section>
						<h3>How can we measure speed?</h3>
						<ul>
							<li class="fragment">Synthetic Tests</li>
							<li class="fragment">Application Monitoring</li>
							<li class="fragment">Analytics</li>
							<li class="fragment">Real User Monitoring</li>
						</ul>
					</section>
					<!--
					<section id="poll-2" data-state="secondary-slide">
						<h2>POLL 2</h2>
						<p>How do you measure speed?</p>
						<ul>
							<li>Synthetic Tests</li>
							<li>Application Monitoring</li>
							<li>Analytics</li>
							<li>Real User Monitoring</li>
						</ul>
					</section>
					-->
				</section>

				<section id="intermission-2" data-state="main-slide">
					<section class="center">
						<h2 class="intermission">&lt; psychology &gt;</h2>
					</section>
					<section>
						<h2>Just Noticeable Difference</h2>
					</section>
					<section>
						<h3>Faster, slower or the same?</h3>
						<div class="demo-container">
							<div class="demo-background-container">
								<div data-demo="1" class="demo-bar demo-background"></div>
								<div data-demo="2" class="demo-bar demo-background"></div>
								<div data-demo="3" class="demo-bar demo-background"></div>
							</div>
							<div class="demo-foreground-container">
								<div data-demo="1" id="demo-bar-1" class="demo-bar demo-foreground demo-med"></div>
								<div data-demo="2" id="demo-bar-2" class="demo-bar demo-foreground demo-fast"></div>
								<div data-demo="3" id="demo-bar-3" class="demo-bar demo-foreground demo-faster"></div>
							</div>
						</div>
						<div class="demo-controls clickable smaller"><span id="demo-reset">reset</span> | <span id="demo-all">all</span></div>
						<!--<img class="cursor" data-animate="bounceOutUp" data-delay="1" src="media/cursor.png"/>-->
						<p class="fragment smallest bottom-right">The 20% Rule: "Designing and Engineering Time" by Steven C. Seow, Ph.D.</p>
					</section>
					<section>
						<h3>So what?</h3>
						<p class="fragment">Get <em>20% faster</em> for existing customers to notice</p>
						<p class="fragment">Be <em>20% faster</em> than your peers &amp; competitors</p>
					</section>
				</section>

				<section id="engagement">
					
					<section>
						<h2>Measuring Engagement üòë</h2>
					</section>
					<section>
						<h3>What do you do when you <span style="color: HSL(356, 75%, 50%);" class="infinite" data-animate="heartBeat">feel</span> engaged?</h3>
						<ul>
							<li class="fragment">Hang around</li>
							<li class="fragment">Click on things</li>
							<li class="fragment">Complete an action</li>
						</ul>
					</section>
					<section data-background-color="#000" data-background-image="media/banking.jpg" data-background-fit="stretch"></section>
					<!--
					<section id="poll-3" data-state="secondary-slide">
						<h2>POLL 3</h2>
						<p>How do you measure engagement?</p>
						<ul>
							<li>Conversion Rate</li>
							<li>Session Length</li>
							<li>Bounce Rate</li>
							<li>Exit Rate</li>
							<li>Time on page</li>
						</ul>
					</section>
					-->
					<section id="sessionlength-chart">
						<h3 class="with-subtitle">Performance metrics correlate with engagement<span class="subtitle">(session length)</span></h3>
						<div class="vega-chart" id="vis1" data-spec="data/sessionlength.json"></div>
						<p class="smallest bottom-right">~1Bn mPulse pageview beacons - early March 2019</p>
						<!--<img class="cursor" style="position: absolute; right: 9%; top: 44%;" data-animate="bounceOutUp" data-delay="1" src="media/cursor.png"/>-->
					</section>

					<section>
						<h3>HCI Principles</h3>
						<ul>
							<li class="fragment">Give feedback within <b>100ms</b></li>
							<li class="fragment">Update every <b>1,000ms</b></li>
							<li class="fragment">Complete actions within <b>3,000ms</b></li>
						</ul>
						<p class="fragment smaller bottom-right">* on all devices</p>
					</section>
					<section>
						<h3>Goals for maximum engagement</h3>
						<table class="compact">
							<tr><th>Timer</th><th>Goal Speed</th></tr>
							<tr><td>First Input Delay (FID)</td><td>100ms</td></tr>
							<tr><td>First Contentful Paint (FCP)</td><td>1,000ms</td></tr>
							<tr><td>Time To Visually Ready (TTVR)</td><td>3,000ms</td></tr>
							<tr><td>Time To Interactive</td><td>3,500ms</td></tr>
						</table>
						<p class="smallest bottom-right">Based on aggregate data - what are yours?</p>
					</section>

					<section>
						<h3>Measuring against your goals</h3>
						<p>What percentage of user experiences achieve the goal?</p>
						<pre><code>perfScore = beacons faster than goal / total beacon count</code></pre>
					</section>
					<section>
						<h3>Performance Regions</h3>
						<img class="stretch" data-src="media/engagement-regions1.png"/>
						<p class="smallest bottom-right"><a href="https://blog.usejournal.com/understanding-performance-regions-e4b6e09a94da">Understanding Performance Regions</a></p>
						
					</section>
					<!--
					<section>
						<h3>Performance Regions</h3>
						<img class="stretch" data-src="media/engagement-regions2.png"/>
						<p class="smallest bottom-right"><a href="https://medium.com/expedia-group-tech/web-performance-vs-user-engagement-7eda84f6436b">Expedia Group - Performance vs User Engagement</a></p>					
					</section>
					-->
					
				</section>
			<!--	
				<section>
					<section>
						<h2>Conclusions ‚úçÔ∏è</h2>
						<ul>
							<li class="fragment">Measuring speed is difficult
								<ul>
									<li>Use metrics which correlate with engagement</li>
									<li>Track the 75th - 95th percentile (with RUM)</li>
								</ul>
							</li>
							<li class="fragment">Deliver <em>something</em> to the user quickly
								<ul>
									<li>Inline critical dependencies</li>
									<li>Optimise your CDN configurations</li>
								</ul>
							</li>
							<li class="fragment">JavaScript is (usually) the bottleneck
								<ul>
									<li>Track longTasks, FID and TTI</li>
									<li>Track third-party scripts</li>
								</ul>
							</li>
						</ul>
					</section>
				</section>
			-->
				<section>
					<section>
						<h2>Conclusions ‚úçÔ∏è</h2>
						<ul>
							<li class="fragment">Speed is a critical factor in UX
								<ul>
									<li>How do your customers track speed?</li>
									<li>What difference would 500ms make?</li>
								</ul>
							</li>
							<li class="fragment">Akamai delivery products improve speed
								<ul>
									<li>TODO</li>
									<li>TODO</li>
								</ul>
							</li>
							<li class="fragment">DPM solutions provide the data
								<ul>
									<li>mPulse tracks real user experience</li>
									<li>CloudTest provides actionable insight under load</li>
								</ul>
							</li>
						</ul>
					</section>
				</section>
				
						
				<section id="intermission-4" data-state="main-slide">
					<section class="center">
						<h2 class="intermission">&lt; psychology &gt;</h2>
					</section>
					<section>
						<h3>There are no guarantees on performance</h3>
						<p class="fragment">but you can buy some time</p>
					</section>
					<section>
						<h3 class="with-subtitle">Anticipate Behaviour<span class="subtitle">cheat with mouse events</span></h3>
						<button id="demo-btn-1" class="btn-big animate-hover" style="cursor:pointer;">Click Me!</button>
						<table style="font-size: 75%;" id="demo-btn-results">
							<tr><th>Event</th><th>Free Time!</th></tr>
							<tr><td>touchStart</td><td id="demo-btn-touch">-</td></tr>
							<tr><td>mouseOver</td><td id="demo-btn-hover">-</td></tr>
							<tr><td>mouseDown</td><td id="demo-btn-down">-</td></tr>
							<tr><td>click</td><td id="demo-btn-click">-</td></tr>
						</table>
						<p class="smaller">Use to anticipate navigations, product viewer actions etc.</p>
					</section>
				</section>	

				<section>
					<section>
						<h2>Thank you üôè</h2>
						<p><a href="https://twitter.com/SimonHearne">@SimonHearne</a></p>
						<p><a href="https://simonhearne.com/">simonhearne.com</a</p>
						<p class="smallest bottom-right">simonhearne.com/presentations/psych-speed</p>
					</section>
				</section>
	
			</div>
			<div id="chart-controls" class="hide"></div>

		</div>

		<script  src="../lib/js/head.min.js"></script>
		<script  src="../js/reveal.js"></script>
		<script  src="../lib/js/jquery-3.3.1.min.js"></script>

		<script>
			function getQueryVariable(variable)
			{
				var query = window.location.search.substring(1);
				var vars = query.split("&");
				for (var i=0;i<vars.length;i++) {
						var pair = vars[i].split("=");
						if(pair[0] == variable){return pair[1];}
				}
				return(false);
			}
			var presenting = window.location.search.includes('present');
			var duration = getQueryVariable('duration') || 30;
			var hasCode = !!document.querySelector('code');
			var hasAnims = !!document.querySelector('[data-animate]');
			var keyboard = {
				// pause/resume time when Enter is pressed
				13: () => {
					ElapsedTimeBar.isPaused ? ElapsedTimeBar.resume() : ElapsedTimeBar.pause();
				},
				// reset timer when 'r' is pressed
				82: () => {
					ElapsedTimeBar.reset();
				}
			}
			if (!presenting) {
				let id = document.getElementById('help-text');
				if (id) {
					id.innerHTML = "Use 'n' and 'p' to navigate next and previous slides.<br>Use 'o' to view an overview."
				}
			} else {
				keyboard = Object.assign(keyboard,
				{
					39: 'next',
					37: 'prev'
				});
			}
			function getFragment(event) {
				return (event.currentSlide.id !== "" ? event.currentSlide.id : null);
			}
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: !presenting,
				progress: true,
				history: true,
				center: true,

				transition: 'none', // none/fade/slide/convex/concave/zoom

				allottedTime: duration * 60 * 1000, // 30 minutes
				barColor: 'hsl(220,99%,54%)',

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: '../lib/js/classList.js', 				async: true, condition: function() { return !document.body.classList; } },
					{ src: '../plugin/markdown/marked.js', 			async: true, condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/markdown/markdown.js', 		async: true, condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/embed-tweet/embed-tweet.js', 	async: true, condition: function() { return !!document.querySelector( 'div.tweet[data-src]' ); } },
					{ src: '../lib/js/vega.min.js', 				condition: function() { return !!document.querySelector( 'div.vega-chart' ); } },
					{ src: '../lib/js/vega-embed.min.js', 			condition: function() { return !!document.querySelector( 'div.vega-chart' ); } },
					{ src: '../plugin/elapsed-time-bar/elapsed-time-bar.js', async: true, condition: function() { return presenting}},
					{ src: '../plugin/highlight/highlight.js', 		async: true, condition: function() {return hasCode},async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '../plugin/search/search.js', 			async: true },
					{ src: '../plugin/zoom-js/zoom.js', 			async: true },
					{ src: '../plugin/notes/notes.js', 				async: true }
				],

				keyboard: keyboard
			});
			Reveal.addEventListener( 'slidechanged', function( event ) {
				let state = {h: event.indexh, v: event.indexv, name: getFragment(event)};
			} );

			/* animate.css */
			// Set animation delay if data-delay is specified
			Reveal.addEventListener('ready', function ( event ) {
				$('*[data-delay]').each( function () { 
					var delay = $(this).attr("data-delay");
					$(this).css("-webkit-animation-delay", delay+"s"); 
					$(this).css("animation-delay", delay+"s"); 
				});
			});

			// Set animation duration if data-duration is specified
			Reveal.addEventListener('ready', function ( event ) {
				$('*[data-duration]').each( function () { 
					var duration = $(this).attr("data-duration");
					$(this).css("-webkit-animation-duration", duration+"s"); 
					$(this).css("animation-duration", duration+"s"); 
				});
				$('.demo-bar').each( function() {
					this.addEventListener("click", () => {
						let demo = this.attributes.getNamedItem("data-demo")
						if (demo) {
							let id = "#demo-bar-"+demo.value;
							$(id).toggleClass("demo-on");
						}
					})
				});
				
				$('#demo-reset').click(function() {
					$('.demo-bar.demo-foreground').css('opacity',0).removeClass("demo-on");
					window.setTimeout(function() {
						$('.demo-bar.demo-foreground').css('opacity',1)
					},1300);
				});
				$('#demo-all').click(function() {
					$('.demo-bar.demo-foreground').addClass("demo-on");
				});
				let width = window.innerWidth / 2;
				$(".vega-chart").each(function() {
					let spec = this.attributes.getNamedItem("data-spec").value;
					//spec = "https://raw.githubusercontent.com/vega/vega/master/docs/examples/bar-chart.vg.json";
					vegaEmbed('#'+this.id, spec, {"actions": false, "theme": "dark", "width": width, "renderer": "svg", "config": "data/config.json"}).then(function(result) {
					// Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
					}).catch(console.error);
				});
				window.demoBtnData = {"mouseover":null,"mousedown":null,"touchstart":null};
				document.getElementById('demo-btn-1').addEventListener("touchstart",()=>{window.demoBtnData.touchstart=performance.now()});
				document.getElementById('demo-btn-1').addEventListener("mouseover",()=>{window.demoBtnData.mouseover=performance.now()});
				document.getElementById('demo-btn-1').addEventListener("mousedown",()=>{window.demoBtnData.mousedown=performance.now()});
				document.getElementById('demo-btn-1').addEventListener("click",()=>{
					let now = performance.now();
					window.demoBtnData.mouseover &&	(document.getElementById("demo-btn-hover").innerHTML = (now - window.demoBtnData.mouseover).toFixed(2)+'ms');
					window.demoBtnData.touchstart && (document.getElementById("demo-btn-touch").innerHTML = (now - window.demoBtnData.touchstart).toFixed(2)+'ms');
					window.demoBtnData.mousedown && (document.getElementById("demo-btn-down").innerHTML = (now - window.demoBtnData.mousedown).toFixed(2)+'ms');
					document.getElementById("demo-btn-click").innerHTML = "0ms";
				});
				/*
				document.getElementById('demo-btn-3').addEventListener("mouseover",()=>{
					fetch('media/pavlov.jpg').then(console.log('Pavlov Fetched!'));
				});
				document.getElementById('demo-btn-3').addEventListener("click",()=>{
					document.getElementById("demo-btn-img-3").innerHTML = "<img src='media/freud.jpg'/>";
				});
				document.getElementById('demo-btn-2').addEventListener("click",()=>{
					document.getElementById("demo-btn-img-2").innerHTML = "<img src='media/pavlov.jpg'/>";
				});
				*/
				
			});

			// Animate items that are not in a fragment
				Reveal.addEventListener('slidechanged', function( event ) {
				// Animate elements that are not a fragment (or in a fragment)
				var filter = '*[data-animate]:not(.fragment):not(.fragment *)';
				
				$(event.currentSlide).find(filter).each( function () {
					$(this).addClass('animated');
					$(this).addClass($(this).attr('data-animate'));
				});		
				$(event.previousSlide).find(filter).each( function () {
					$(this).removeClass('animated');
					$(this).removeClass($(this).attr('data-animate'));
				});		
				});

				// Animate fragments
				Reveal.addEventListener('fragmentshown', function( event ) {
					function loop(i, el) { 
						if ($(el).attr('data-animate')) {
							$(el).addClass('animated');
							$(el).addClass($(el).attr('data-animate'));
						}
						$.each($(el).children().not('.fragment'), loop);
					};
					$.each(event.fragments, loop);
				});

				// Make the animation runnable again if fragment is hidden
				Reveal.addEventListener('fragmenthidden', function( event ) {	  
				function loop(i, el) { 
					if ($(el).attr('data-animate')) {
						$(el).removeClass('animated');
						$(el).removeClass($(el).attr('data-animate'));
					}
					$.each($(el).children().not('.fragment'), loop);
				};
				$.each(event.fragments, loop);
			});
			if (hasCode) {
				var l = document.createElement('link');
				l.rel="stylesheet";
				l.href = "../lib/css/zenburn.css"
				document.head.appendChild(l);
			}
			if (hasAnims) {
				var l = document.createElement('link');
				l.rel="stylesheet";
				l.href = "../lib/css/animate.min.css"
				document.head.appendChild(l);
			}
		</script>

		<script nonce="googleAnalytics">
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
			i.initAnalytics=function(){a=s.createElement(o),m=s.getElementsByTagName(o)[0];
			a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			}})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			ga('create', 'UA-6512525-16', 'auto', {'siteSpeedSampleRate': 100});
			ga('send', 'pageview');
			
			window.addEventListener('load',function(){initAnalytics()});
		</script>
	</body>
</html>
