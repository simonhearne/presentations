<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Optimising Core Web Vitals on SPAs - @SimonHearne</title>
		<base target="_blank"></base>
		<meta name="description" content="Presentation: Optimising Core Web Vitals on SPAs.">
		<meta name="author" content="Simon Hearne">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../css/reveal.css">
		<link rel="stylesheet" href="../css/theme/simon2.css" id="theme">

		<meta property="og:image" content="https://simonhearne.com/presentations/inclusive-design/social.png" />
		<meta property="og:image:width" content=1200 />
		<meta property="og:image:height" content=600 />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:creator" content="@SimonHearne" />
		<meta name="twitter:title" content="Presentation: Optimising Core Web Vitals on SPAs.">
		<meta name="twitter:description" content="" />
		<meta name="twitter:image" content="https://simonhearne.com/presentations/inclusive-design/social.png" />
		
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../css/print/pdf.css' : '../css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="reveal">
			<div class="tagline"><a class="tagline-link" href="https://twitter.com/simonhearne">@SimonHearne</a></div>
			<!-- Entertain, inform, educate -->
			<div class="slides">
				<section data-state="title-slide">
					<h1>Optimising Core Web Vitals for <span style="font-style:oblique;">SPAs</span></h1>
					<p style="margin:0;">Simon Hearne</p>
					<p class="smaller" style="margin:0;">Web Performance Consultant</p>
					<aside class="notes">
						<p>Welcome to this presentation on Core Web Vitals and Single Page Applications.</p>
						<p>Use keys '<code>n</code>' and '<code>p</code>' to navigate forwards and backwards through the slides.<br>
						Use key '<code>o</code>' to view an overview, press '<code>m</code>' to toggle this notes window.</p>
						<p>If you have any questions or feedback, please contact Simon on <a href="https://twitter.com/SimonHearne">Twitter</a> or by email - simon (at) hearne (dot) me.</p>
					</aside>
				</section>
				<section id="intro">
					<section data-auto-animate>
						<blockquote>Hi Simon! I was wondering if you could help with...</blockquote><br>
						<img style="max-width: 75%;" loading="lazy" class="fragment" src="media/2022-05-06-09-04-15.png"/>
					</section>
					<section>
						<img style="max-width: 75%;" loading="lazy" src="media/2022-05-06-09-33-30.png"/>
					</section>
					<section>
						<h2>Don't panic!</h2>
						<p>Core Web Vitals are your friend, not your foe</p>
					</section>
					<section>
						<h2>In this talk:</h2>
						<ul class="lightning-bullets">
							<li>What the Core Web Vitals are</li>
							<li>Why they matter (to you and Google)</li>
							<li>Why SPAs are special</li>
							<li>How to improve and monitor progress</li>
						</ul>
					</section>
				</section>


				<section>
					<section data-auto-animate>
						<h2>Core Web Vitals?</h2>
					</section>
					<section data-auto-animate>
						<h2>Core Web Vitals?</h2>
						<p>Not just that Google thing</p>
					</section>
					<section>
						<h2>CWVs are proxies of<br><em>User Experience</em></h2>
					</section>
					<section data-auto-animate data-background-image="../backgrounds/vitals_monitor.jpg">
					</section>
					<section data-auto-animate data-background-image="../backgrounds/vitals_monitor.jpg">
						<dl style="background: rgba(0,0,0,0.5);padding: 20px 100px;">
							<dt>Largest Contentful Paint</dt>
							<dd>How fast it feels</dd>
							<dt>Cumulative Layout Shift</dt>
							<dd>How jumpy it is</dd>
							<dt>First Input Delay</dt>
							<dd>How interactive it feels</dd>
							<div class="fragment">
								<dt>Input to Next Paint</dt>
								<dd>How interactive it feels</dd>
							</div>
						</dl>
					</section>
				</section>


				<section id="field_vs_lab">
					<section data-background-image="../backgrounds/test-tube.jpg">
						<h2 class="dark-bg">Intermission:<br>Field vs. Lab</h2>
					</section>
					<section>
						<h2>üß™ Lab</h2>
						<p>Controlled tests of a single page / interaction</p>
					</section>
					<section>
						<h2>üåç Field</h2>
						<p>Real data from real users out on interweb</h2>
					</section>
					<section>
						<h2>Distributions &amp; Percentiles</h2>

						<ul class="no-bullets small">
							<li>CWV measured in the field, where data is noisy</li>
							<li>We use summary metrics to make sense of the noise</li>
							<li><em>75th percentile</em> - ¬º experiences are worse, ¬æ better</li>
						</ul>
						<img loading="lazy" class="fragment" style="max-width:50%" src="media/2022-05-06-12-41-54.png"/>
					</section>
					<section>
						<h2>Results will differ between tools</h2>
						<ul class="no-bullets">
							<li>Google Analytics + web_vitals.js üåç</li>
							<li>CrUX (PSI, GSC) <span style="position:relative">üåç<span style="position:absolute;left:0;">üß™</span></span></li>
							<li>Search Console üåç</li>
							<li>Real User Monitoring üåç</li>
							<li>WebPageTest üß™</li>
						</ul>
					</section>
					<section>
						<h2>Who uses what?</h2>
						<ul class="no-bullets">
							<li>Search Console for SEO folks</li>
							<li>CrUX &amp; RUM for product</li>
							<li>PSI &amp; WebPageTest for engineers</li>
						</ul>
					</section>
				</section>
				

				<section id="why_cwv_matter">
					<section>
						<h2>Why Core Web Vitals Matter</h2>
					</section>

					<section>
						<svg viewBox="0 0 48 48" style="width:10ch;">
						<title>Google Logo</title>
						<clipPath id="g">
							<path d="M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z"/>
						</clipPath>
						<g class="colors" clip-path="url(#g)">
							<path fill="#FBBC05" d="M0 37V11l17 13z"/>
							<path fill="#EA4335" d="M0 11l17 13 7-6.1L48 14V0H0z"/>
							<path fill="#34A853" d="M0 37l30-23 7.9 1L48 0v48H0z"/>
							<path fill="#4285F4" d="M48 48L17 24l-4-3 35-10z"/>
						</g>
						</svg>
						<h2>Search <span data-animate="heartBeat" class="delay-1s infinite">‚ù§Ô∏è</span> CWV <span data-animate="heartBeat" class="delay-1s infinite">‚ù§Ô∏è</span> Speed</h2>
					</section>

					<section data-state="tertiary-slide">
						<h2>SEO impact of Core Web Vitals</h2>
					</section>
					<section data-state="tertiary-slide">
						<h2>SEO is a <span data-animate="heartBeat" class="delay-1s">ü•ï</span> to create better UX</h2>
						<p class="fragment">Don't expect massive ranking boosts</p>
					</section>
					<section>
						<h2>CWV are not pass / fail!</h2>
						<img loading="lazy" style="max-width:75%;" src="media/2022-05-06-10-25-13.png">
						<p class="fragment">Assuming max ranking boost of 1, this page will get ~0.75</p>
						<aside class="notes">
						<p>Assuming a maximum ranking boost of 1, achieving a high amber in LCP, green in CLS and green in FID will give you a ranking boost of 0.75</p>
						</aside>
					</section>
					<section data-state="tertiary-slide">
						<h2><span data-animate="hinge" class="delay-2s">SEO </span> impact of Core Web Vitals</h2>
					</section>
					<section data-background-image="../backgrounds/clock.jpg">
						<h2 style="width: 33%;color: #69b1c1;">A brief history of #WebPerf</h2>
					</section>
					<section>
						<ul>
							<li><span style="font-family: monospace">2010</span> - Navigation Timing API</li>
							<li class="fragment"><span style="font-family: monospace">2017</span> - Paint Timing API</li>
							<li class="fragment"><span style="font-family: monospace">2019</span> - ALL THE APIS <span class="fragment smaller"> (in Chrome)</span>
							<ul class="fragment">
								<li>LargestContentfulPaint API</li>
								<li>LayoutInstability API</li>
								<li>EventTiming API</li>
							</li>
						</ul>
					</section>
				</section>


				<section id="why_spas_special">
					<section data-background-image="../backgrounds/coffee_split.jpg">
						<h2 style="transform:rotate(36deg);margin-top:25%;">CWV &amp; SPAs</h2>
						<aside class="notes">
							<p>Core Web Vitals and Single Page Application frameworks have something in common - they have been very divisive!<p>
						</aside>
					</section>
					
					<section>
						<h2>SPAs <span data-animate="jello" class="infinite" >break</span> a lot of stuff</h2>
					</section>
					<section>
						<h2>SPAs break performance APIs</h2>
						<p class="fragment">One load event per session, one FCP, one LCP...</p>
					</section>
					<section>
						<h2>LCP is only measured on the<br>first page load</h2>
					</section>
					<section>
						<h2>CLS is measured throughout<br>the whole session</h2>
						<p class="fragment">This breaks page-level attribution üò±</p>
					</section>
					<section>
						<h2>FID is only measured on the<br>first page load</h2>
					</section>
					<section>
						<h2>In summary...</h2>
						<p>SPA websites are penalised by <br>ignoring mid-session navigations</p>
						<p class="fragment">except CLS - where the <em>worst</em> 1-5s window is captured</p>
					</section>
				</section>

				<section id="optimising_spas">
					<section data-state="tertiary-slide">
						<h2>Optimising CWVs on SPAs</h2>
					</section>
					
					<section>
						<h2>Largest Contentful Paint</h2>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-10-42-40.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-10-43-52.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-10-47-14.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-10-48-09.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-10-50-59.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-10-51-38.png"/>
					</section>
					<section>
						<h2>Let's remove preloads</h2>
						<img loading="lazy" style="max-width: 75%;" src="media/2022-05-06-11-11-09.png"/>
						<p class="subtitle smallest bottom-left"><a href="https://perfproxy.com">perfproxy.com</a></p>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-11-05-24.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-11-06-02.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-11-06-33.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-11-13-27.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" src="media/2022-05-06-11-15-06.png"/>
					</section>
					<section data-auto-animate>
						<img loading="lazy" style="max-width: 75%;"  src="media/2022-05-06-11-16-09.png"/>
						<p class="subtitle smallest bottom-left"><a href="https://www.debugbear.com/html-size-analyzer">HTML Size Analyser</a></p>
					</section>
					<section>
						<h2>Where we got to (3G)</h2>
						<img class="fragment" nloading="lazy" src="media/2022-05-06-12-17-21.png"/>
					</section>
					<section>
						<h2>LCP top-tips</h2>
						<ul>
							<li class="fragment">SSR all landing pages</li>
							<li class="fragment">Defer / reduce / remove hydration</li>
							<li class="fragment">Increase hero element priority</li>
							<li class="fragment">Only preload critical assets</li>
							<li class="fragment">No cross-origin requests in critical path</li>
							<li class="fragment">Reduce HTML size (<50kB compressed)</li>
						</ul>
					</section>
					<section>
						<h2>Image LCP?</h2>
						<ul class="lightning-bullets">
							<li class="fragment">Ensure <code>&lt;img src=""&gt;</code> in HTML source</li>
							<li class="fragment">Ensure <code>loading</code> attribute is <em>not</em> <code>"lazy"</code></li>
							<li class="fragment">Try <code>fetchpriority="high"</code> attribute</li>
							<li class="fragment">Keep hero images &lt;100kB</li>
							<li class="fragment">Use modern formats<br>(<code>AVIF</code> &gt; <code>WEBP</code> &gt; <code>JPEG</code> &gt; <code>PNG</code> &gt; <code>GIF</code>)</li>
						</ul>
					</section>
					
					<section>
						<h2>Cumulative Layout <span data-animate="shake" class="delay-1s infinite slow">Shift</span></h2>
					</section>
					
					<section>
						<style>
							#fid-heading {
								cursor: pointer;
							}
							#fid-heading:active {
								margin-top: 2px;
							}
							#fid-heading.active {
								color: lightcoral;
							}
						</style>
						<h2 id="fid-heading">First Input Delay</h2>
						<script>
							let fid_el = document.getElementById('fid-heading');
							fid_el.addEventListener('click',(el) => {
								setTimeout(()=>{el.target.classList.toggle('active')},500)
							})
						</script>
					</section>

					<section>
						<h2>Bonus:<br>Input to Next Paint (INP)</h2>
					</section>
				</section>


				<section id="summary">
					<section>
						<h2>In summary</h2>
						<p>CWVs are a useful tool, SEO impact is low, CrUX is free RUM data</p>
						<p>Optimising for CWVs is (normally) quite simple - and will benefit business metrics</p>
						<p>Become the "go-to" for CWV in your organisation to build personal brand</p>
					</section>
					<section class="pull-up" data-background-image="media/cyclist_number.jpeg">
						<h2>Chase one number at your peril</h2>
					</section>
					<section>
						<h2>Links &amp; Tools</h2>
						<ul>
							<li><a href="https://webperf.tools/">WebPerf.tools</a> - my library of useful tools</li>
							<li><a href="https://simonhearne.com/2022/core-web-vitals-on-spas/">simonhearne.com/2022/core-web-vitals-on-spas/</a> - this talk, as a post</li>
						</ul>
					</section>
					<section class="pull-up" data-background-image="../backgrounds/passion.jpg">
						<h2 class="dark-bg">Thank you üôè</h2>
						<p class="dark-bg" style="margin-top: 9em !important;"><a style="color:white !important;" href="https://twitter.com/SimonHearne">@SimonHearne</a><br><a style="color:white !important;" href="https://simonhearne.com/">simonhearne.com</a></p>
					</section>
				</section>
			</div>
			<div id="chart-controls" class="hide"></div>

		</div>

		<script src="../lib/js/head.min.js"></script>
		<script src="../js/reveal-4.1.3.min.js"></script>
		<script src="../lib/js/jquery-3.3.1.min.js"></script>

		<script>
			function sleep(ms) {
				return new Promise(resolve => setTimeout(resolve, ms));
			}
			function getQueryVariable(variable)
			{
				var query = window.location.search.substring(1);
				var vars = query.split("&");
				for (var i=0;i<vars.length;i++) {
						var pair = vars[i].split("=");
						if(pair[0] == variable){return pair[1];}
				}
				return(false);
			}
			var presenting = window.location.search.includes('present');
			var duration = getQueryVariable('duration') || 40;
			var hasCode = !!document.querySelector('code');
			var hasAnims = !!document.querySelector('[data-animate]');
			var keyboard = {
				// pause/resume time when Enter is pressed
				13: () => {
					ElapsedTimeBar.isPaused ? ElapsedTimeBar.resume() : ElapsedTimeBar.pause();
				},
				// reset timer when 'r' is pressed
				82: () => {
					ElapsedTimeBar.reset();
				},
				77: () => {
					Reveal.configure({showNotes: !!!Reveal.getConfig().showNotes});
				},
				// zero key to first slide
				48: () => {
					Reveal.slide( 0 );
				}
			}
			if (presenting) {
				document.body.classList.add("presenting");
				keyboard = Object.assign(keyboard,
				{
					39: 'next',
					37: 'prev'
				});
			}
			
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: !presenting,
				showNotes: !presenting,
				progress: true,
				history: true,
				center: true,

				transition: 'none', // none/fade/slide/convex/concave/zoom
				transitionSpeed: 'fast',

				allottedTime: duration * 60 * 1000, // 30 minutes
				barColor: 'hsl(220,99%,54%)',

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: '../lib/js/classList.js', 				async: true, condition: function() { return !document.body.classList; } },
					{ src: '../plugin/markdown/marked.js', 			async: true, condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/markdown/markdown.js', 		async: true, condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: '../plugin/embed-tweet/embed-tweet.js', 	async: true, condition: function() { return !!document.querySelector( 'div.tweet[data-src]' ); } },
					{ src: '../lib/js/vega.min.js', 				condition: function() { return !!document.querySelector( 'div.vega-chart' ); } },
					{ src: '../lib/js/vega-embed.min.js', 			condition: function() { return !!document.querySelector( 'div.vega-chart' ); } },
					{ src: '../plugin/elapsed-time-bar/elapsed-time-bar.js', async: true, condition: function() { return presenting}},
					{ src: '../plugin/highlight/highlight.js', 		async: true, condition: function() {return hasCode},async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '../plugin/search/search.js', 			async: true },
					{ src: '../plugin/zoom-js/zoom.js', 			async: true },
					{ src: '../plugin/notes/notes.js', 				async: true }
				],

				keyboard: keyboard
			});

			/* custom stuff */
			Reveal.addEventListener('ready', function ( event ) {
				// Set animation delay if data-delay is specified
				$('*[data-delay]').each( function () { 
					var delay = $(this).attr("data-delay");
					$(this).css("-webkit-animation-delay", delay+"s"); 
					$(this).css("animation-delay", delay+"s"); 
				});
				// Set animation duration if data-duration is specified
				$('*[data-duration]').each( function () { 
					var duration = $(this).attr("data-duration");
					$(this).css("-webkit-animation-duration", duration+"s"); 
					$(this).css("animation-duration", duration+"s"); 
				});
				// initialize vega charts
				let width = window.innerWidth / 2;
				$(".vega-chart").each(function() {
					let spec = this.attributes.getNamedItem("data-spec").value;
					//spec = "https://raw.githubusercontent.com/vega/vega/master/docs/examples/bar-chart.vg.json";
					vegaEmbed('#'+this.id, spec, {"actions": false, "theme": "dark", "width": width, "renderer": "svg", "config": "data/config.json"}).then(function(result) {
					// Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
					}).catch(console.error);
				});
				
			});

			// Animate items that are not in a fragment
				Reveal.addEventListener('slidechanged', function( event ) {
				// Animate elements that are not a fragment (or in a fragment)
				var filter = '*[data-animate]:not(.fragment):not(.fragment *)';
				
				$(event.currentSlide).find(filter).each( function () {
					$(this).addClass('animated');
					$(this).addClass($(this).attr('data-animate'));
				});		
				$(event.previousSlide).find(filter).each( function () {
					$(this).removeClass('animated');
					$(this).removeClass($(this).attr('data-animate'));
				});		
				});

				// Animate fragments
				Reveal.addEventListener('fragmentshown', function( event ) {
					function loop(i, el) { 
						if ($(el).attr('data-animate')) {
							$(el).addClass('animated');
							$(el).addClass($(el).attr('data-animate'));
						}
						$.each($(el).children().not('.fragment'), loop);
					};
					$.each(event.fragments, loop);
				});

				// Make the animation runnable again if fragment is hidden
				Reveal.addEventListener('fragmenthidden', function( event ) {	  
				function loop(i, el) { 
					if ($(el).attr('data-animate')) {
						$(el).removeClass('animated');
						$(el).removeClass($(el).attr('data-animate'));
					}
					$.each($(el).children().not('.fragment'), loop);
				};
				$.each(event.fragments, loop);
			});
			if (hasCode) {
				var l = document.createElement('link');
				l.rel="stylesheet";
				l.href = "../lib/css/zenburn.css"
				document.head.appendChild(l);
			}
			if (hasAnims) {
				var l = document.createElement('link');
				l.rel="stylesheet";
				l.href = "../lib/css/animate.min.css"
				document.head.appendChild(l);
			}
		</script>

		<script nonce="googleAnalytics">
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
			i.initAnalytics=function(){a=s.createElement(o),m=s.getElementsByTagName(o)[0];
			a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			}})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			ga('create', 'UA-6512525-16', 'auto', {'siteSpeedSampleRate': 100});
			ga('send', 'pageview');
			
			window.addEventListener('load',function(){initAnalytics()});
		</script>
	</body>
</html>
